# 第三章 数据链路层

## 1. 功能

- 数据链路层在物理层提供服务的基础上**向网络层提供服务**，其最基本的服务是将源自网络层来的数据**可靠**地传输到相邻节点的目标机网络层。其主要作用是**加强物理层传输原始比特流的功能**，将物理层提供的可能出错的物理连接改造成为**逻辑上无差错的数据链路**，使之对网络层表现为一条无差错的链路。

>功能一：为网络层提供服务。无确认无连接服务，有确认无连接服务，有确认面向连接服务。 有连接一定有确认！
>
>功能二：链路管理，即连接的建立、维持、释放（用于面向连接的服务）。 
>
>功能三：组帧。 功能四：流量控制。 功能五：差错控制（帧错/位错）。

## 2. 组帧

- 封装成帧：在一段数据的前后部分添加首部和尾部，这样就构成了一个帧。
- 帧同步：接收方应当能从接收到的二进制比特流中区分出帧的起始和终止。
- 透明传输：不管所传数据是什么样的比特组合，都应当能够在链路上传送。

![image-20220426103227329](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426103227329.png)

### 2.1 组帧的四种方法

>1. 字符计数法
>2. 字符（节）填充法
>3. 零比特填充法
>4. 违规编码法

#### 2.1.1 字符计数法

- 帧首部使用一个计数字段（第一个字节，八位）来标明帧内字符数。
- 缺点：一旦一个帧出现了缺失字符等情况，会影响到后面的帧

![image-20220426103558828](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426103558828.png)

#### 2.1.2 字符（节）填充法

- 使用ASCII码，比如键盘上面的字符时，可以直接实现透明传输，但是使用非ASCII码，如二进制数字时，需要采用字符填充方法实现透明传输
- 如下图所示：SOH是开始，EOT是结束，ESC是转义

![image-20220426104252507](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426104252507.png)

#### 2.1.3 零比特填充法

1. 在发送端，扫描整个信息字段，只要连续5个1，就立即填入1个0。
2. 在接收端收到一个帧时，先找到标志字段确定边界，再用硬件对比特流进行扫描。发现连续5个1时，就把后面的0删除。
3. 保证了透明传输：在传送的比特流中可以传送任意比特组合，而不会引起对帧边界的判断错误。

![image-20220426104545003](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426104545003.png)

#### 2.1.4 违规编码法

- 如下所示，比如使用曼彻斯特编码时，可以使用与曼彻斯特编码不同的编码方式定义首尾

![image-20220426104808301](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426104808301.png)

## 3.  差错控制

### 3.1 检错编码

#### 3.1.1 奇偶校验码

- n-1位信息元，1 位校验元
- 奇偶校验码特点：只能检查出奇数位的比特错误，检错能力为50%

#### 3.1.2 CRC (循环冗余码)

- 生成多项式是题目会直接给出的
- r + 1 位是生成多项式的二进制位数，如果给出的是代数形式的多项式，需要会转换成二进制
- 除法为<u>模二除</u>
- FCS的生成以及接收端CRC检验都是由硬件实现，处理很迅速， 因此不会延误数据的传输。

![image-20220426105712091](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426105712091.png)

### 3.2 纠错编码

#### 3.2.1 海明码

- 两个码字的对应比特取值不同的比特数称为这两个码字的海明距离(码距)，在一个有效编码集中，任意两个码字的海明距离的最小值称为该编码集的海明距离(码距)

1. **确定校验码位数 r**

![image-20220426110621727](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426110621727.png)

</br>

2. **确定校验码和数据的位置**

- 放在2的n次方位置上，比如放在2、4、8、16 ......

![image-20220426111813579](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426111813579.png)

</br>

3. **求出校验码的值**

- 把序号化为二进制数，和序号中与 1 位置相同的（包括其本身）分为一组
- 对不同组的数进行二进制排列，进行偶校验的方式得出 0或1的结果，并填入所负责的校验码的位置中

![image-20220426111830445](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426111830445.png)

</br>

4. **检错并纠错**

![image-20220426111911418](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426111911418.png)

![image-20220426111932424](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426111932424.png)



## 4. 流量控制和可靠传输机制

>- 停止等待协议：发送窗口大小 =1，接收窗口大小 =1
>- 后退N帧协议（GBR）：发送窗口大小 >1，接收窗口大小 =1
>- 选择重传协议（SR）：发送窗口大小 >1，接收窗口大小 > 1

### 4.1 停止等待协议

- 目的：实现流量控制
- 缺点：除了比特出差错，底层信道还会出现丢包问题，信道利用率低
- 实现前提：半双工（我们研究的）和全双工
- 可能出现的情况：**无差错情况&有差错情况**

![image-20220426120213310](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426120213310.png)

![image-20220426120245500](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426120245500.png)

![image-20220426120311926](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426120311926.png)

![image-20220426120328546](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426120328546.png)

##### 信道利用率

![image-20220426120525756](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426120525756.png)

### 4.2 滑动窗口协议

#### 4.2.1 后退N帧协议(GBN)

##### 1.发送方

![image-20220426121031532](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121031532.png)

##### 2.接收方

![image-20220426121103475](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121103475.png)

##### 3.滑动窗口长度

![image-20220426121235782](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121235782.png)

##### 4.性能分析

- 因连续发送数据帧而提高了信道利用率 
- 在重传时必须把原来已经正确传送的数据帧重传，传送效率降低。

</br>

#### 4.2.2 选择重传协议(SR)

##### 1.发送方

![image-20220426121521817](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121521817.png)

##### 2.接收方

![image-20220426121610226](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121610226.png)

##### 3. 滑动窗口长度

![image-20220426121715229](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121715229.png)



## 5 介质访问控制

![image-20220426121848116](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121848116.png)



## 6. 局域网



## 7. 广域网



## 8. 数据链路层设备

