---
title: 数据链路层
date: 2022/4/26
categories: 计算机网络
tags: [计算机网络]
top_img: https://herozql.oss-cn-beijing.aliyuncs.com/bg_pic/bing_56.jpg
cover: https://herozql.oss-cn-beijing.aliyuncs.com/bg_pic/bing_56.jpg
---



# 第三章 数据链路层

## 1. 功能

- 数据链路层在物理层提供服务的基础上**向网络层提供服务**，其最基本的服务是将源自网络层来的数据**可靠**地传输到相邻节点的目标机网络层。其主要作用是**加强物理层传输原始比特流的功能**，将物理层提供的可能出错的物理连接改造成为**逻辑上无差错的数据链路**，使之对网络层表现为一条无差错的链路。

>功能一：为网络层提供服务。无确认无连接服务，有确认无连接服务，有确认面向连接服务。 有连接一定有确认！
>
>功能二：链路管理，即连接的建立、维持、释放（用于面向连接的服务）。 
>
>功能三：组帧。 功能四：流量控制。 功能五：差错控制（帧错/位错）。

## 2. 组帧

- 封装成帧：在一段数据的前后部分添加首部和尾部，这样就构成了一个帧。
- 帧同步：接收方应当能从接收到的二进制比特流中区分出帧的起始和终止。
- 透明传输：不管所传数据是什么样的比特组合，都应当能够在链路上传送。

![image-20220426103227329](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426103227329.png)

### 2.1 组帧的四种方法

>1. 字符计数法
>2. 字符（节）填充法
>3. 零比特填充法
>4. 违规编码法

#### 2.1.1 字符计数法

- 帧首部使用一个计数字段（第一个字节，八位）来标明帧内字符数。
- 缺点：一旦一个帧出现了缺失字符等情况，会影响到后面的帧

![image-20220426103558828](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426103558828.png)

#### 2.1.2 字符（节）填充法

- 使用ASCII码，比如键盘上面的字符时，可以直接实现透明传输，但是使用非ASCII码，如二进制数字时，需要采用字符填充方法实现透明传输
- 如下图所示：SOH是开始，EOT是结束，ESC是转义

![image-20220426104252507](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426104252507.png)

#### 2.1.3 零比特填充法

1. 在发送端，扫描整个信息字段，只要连续5个1，就立即填入1个0。
2. 在接收端收到一个帧时，先找到标志字段确定边界，再用硬件对比特流进行扫描。发现连续5个1时，就把后面的0删除。
3. 保证了透明传输：在传送的比特流中可以传送任意比特组合，而不会引起对帧边界的判断错误。

![image-20220426104545003](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426104545003.png)

#### 2.1.4 违规编码法

- 如下所示，比如使用曼彻斯特编码时，可以使用与曼彻斯特编码不同的编码方式定义首尾

![image-20220426104808301](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426104808301.png)

## 3.  差错控制

### 3.1 检错编码

#### 3.1.1 奇偶校验码

- n-1位信息元，1 位校验元
- 奇偶校验码特点：只能检查出奇数位的比特错误，检错能力为50%

#### 3.1.2 CRC (循环冗余码)

- 生成多项式是题目会直接给出的
- r + 1 位是生成多项式的二进制位数，如果给出的是代数形式的多项式，需要会转换成二进制
- 除法为<u>模二除</u>
- FCS的生成以及接收端CRC检验都是由硬件实现，处理很迅速， 因此不会延误数据的传输。

![image-20220426105712091](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426105712091.png)

### 3.2 纠错编码

#### 3.2.1 海明码

- 两个码字的对应比特取值不同的比特数称为这两个码字的海明距离(码距)，在一个有效编码集中，任意两个码字的海明距离的最小值称为该编码集的海明距离(码距)

1. **确定校验码位数 r**

![image-20220426110621727](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426110621727.png)

</br>

2. **确定校验码和数据的位置**

- 放在2的n次方位置上，比如放在2、4、8、16 ......

![image-20220426111813579](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426111813579.png)

</br>

3. **求出校验码的值**

- 把序号化为二进制数，和序号中与 1 位置相同的（包括其本身）分为一组
- 对不同组的数进行二进制排列，进行偶校验的方式得出 0或1的结果，并填入所负责的校验码的位置中

![image-20220426111830445](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426111830445.png)

</br>

4. **检错并纠错**

![image-20220426111911418](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426111911418.png)

![image-20220426111932424](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426111932424.png)



## 4. 流量控制和可靠传输机制

>- 停止等待协议：发送窗口大小 =1，接收窗口大小 =1
>- 后退N帧协议（GBR）：发送窗口大小 >1，接收窗口大小 =1
>- 选择重传协议（SR）：发送窗口大小 >1，接收窗口大小 > 1

### 4.1 停止等待协议

- 目的：实现流量控制
- 缺点：除了比特出差错，底层信道还会出现丢包问题，信道利用率低
- 实现前提：半双工（我们研究的）和全双工
- 可能出现的情况：**无差错情况&有差错情况**

![image-20220426120213310](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426120213310.png)

![image-20220426120245500](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426120245500.png)

![image-20220426120311926](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426120311926.png)

![image-20220426120328546](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426120328546.png)

##### 信道利用率

![image-20220426120525756](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426120525756.png)

### 4.2 滑动窗口协议

#### 4.2.1 后退N帧协议(GBN)

##### 1.发送方

![image-20220426121031532](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121031532.png)

##### 2.接收方

![image-20220426121103475](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121103475.png)

##### 3.滑动窗口长度

![image-20220426121235782](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121235782.png)

##### 4.性能分析

- 因连续发送数据帧而提高了信道利用率 
- 在重传时必须把原来已经正确传送的数据帧重传，传送效率降低。

</br>

#### 4.2.2 选择重传协议(SR)

##### 1.发送方

![image-20220426121521817](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121521817.png)

##### 2.接收方

![image-20220426121610226](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121610226.png)

##### 3. 滑动窗口长度

![image-20220426121715229](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121715229.png)



## 5 介质访问控制

![image-20220426121848116](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220426121848116.png)

### 5.1 ALOHA协议（随机访问协议）

>- 纯ALOHA协议
>- 时隙ALOHA协议

#### 5.1.1 纯ALOHA协议

- 纯ALOHA协议思想：不监听信道，不按时间槽发送，随机重发。**想发就发**
- 若发生冲突：接收端不予确认，发送端收不到确认就重发
- 解决冲突：超时后随机一段时间后重传

#### 5.1.2 时隙ALOHA协议

- 时隙ALOHA协议的思想：把时间分成若干个相同的**时间片**，所有用户在时间片开始时刻同步接入网络信道， 若发生冲突，则必须等到下一个时间片开始时刻再发送。**控制想发就发的随意性**

#### 5.1.3 两者比较

1. 纯ALOHA比时隙ALOHA吞吐量更低，效率更低。
2. 纯ALOHA想发就发，时隙ALOHA只有在时间片段开始时才能发。

</br>

### 5.2 CSMA协议

- CS：载波侦听/监听，每一个站在发送数据之前要检测一下总线上是否有其他计算机在发送数据。
- MA：多点接入，表示许多计算机以多点接入的方式连接在一根总线上。
- 协议思想：发送帧之前，监听信道。

![image-20220428175030084](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220428175030084.png)

|            | 优点                                                         | 缺点                                                         |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1-坚持CSMA | 只要媒体空闲，站点就马上发送，避免了媒体利用率的损失         | 假如有两个或两个以上的站点有数据要发送，冲突就不可避免       |
| 非坚持CSMA | 采用随机的重发延迟时间可以减少冲突发生的可能性。             | 可能存在大家都在延迟等待过程中，使得媒体仍可能处于空闲状态，媒体使用率降低 |
| p-坚持CSMA | 既能像非坚持算法那样减少冲突，又能像1-坚持算法那样减少媒体空闲时间 | 发生冲突后还是要坚持把数据帧发送完，造成了浪费               |

</br>

### 5.3 CSMA/CD协议

- CD：碰撞检测（冲突检测），“边发送边监听”，适配器边发送数据边检测信道上信号电压的变化情况，以便判断自己在发送数据时其他站是否也在发送数据。
- 先听后发发生冲突的原因：电磁波在总线上总是以有限的速率传播的
- 避免冲突的方法：让传输时延是传播时延的两倍
- **最小帧长=总线传播时延 x 数据传输速率 x 2**

#### 5.3.1 确定碰撞后的重传时机

![image-20220428175826495](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220428175826495.png)

</br>

### 5.4 CSMA/CA协议

#### 5.4.1 工作原理

1. 发送数据前，先检测信道是否空闲。 空闲则发出RTS；信道忙则等待。
2.  接收端收到RTS后，将响应CTS。 发送端收到CTS后，开始发送数据帧（同时预约信道：发送方告知其他站点自己要传多久数据）。
3.  接收端收到数据帧后，将用CRC来检验数据是否正确，正确则响应ACK帧。 
4. 发送方收到ACK就可以进行下一个数据帧的发送，若没有则一直重传至规定重发次数为止（采用二进制指数 退避算法来确定随机的推迟时间）。

#### 5.4.2 CSMA/CD与CSMA/CA

- 相同点：两个在接入信道之前都须要 进行监听。当发现信道空闲后，才能进行接入。
- 不同点：

>1. 传输介质不同：CSMA/CD 用于总线式以太网【有线】，而CSMA/CA用于无线局域网【无线】。 
>2. 载波检测方式不同：因传输介质不同，CSMA/CD通过电缆中**电压**的变化来检测；而CSMA/CA采用能量检测（ED）、 载波检测（CS）和能量载波混合检测三种检测信道空闲的方式。 
>3. CSMA/CD检测冲突，CSMA/CA避免冲突，二者出现冲突后都会进行有上限的重传。

</br>

### 5.5 多路复用（信道划分介质随机访问）

1. 频分多路复用（FDM）
2. 时分多路复用（TDM）
   - 异步时分多路复用（STDM）：动态分配时隙

3. 波分多路复用（WDM）
4. 码分多路复用（CDM）

### 5.6 令牌传输协议（轮询访问协议）

- 令牌：一个特殊格式的MAC控制帧，不含任何信息。 控制信道的使用，确保同一时刻只有一个结点独占信道。
- 问题： 1.令牌开销 2.等待延迟 3.单点故障
- 应用于：令牌环网（物理星型拓扑，逻辑环形拓扑）。 采用令牌传送方式的网络常用于负载较重、通信量较大的网络中



## 6. 局域网

### 6.1 概述

- 局域网：简称LAN，使用广播信道。
- 决定局域网的主要要素为：网络拓扑，传输介质与介质访问控制方法。

- 局域网的拓扑结构

>1. 星型
>2. 总线型
>3. 环型
>4. 树型

- 局域网介质访问控制方法

>1. CSMA/CD  ，常用于总线型局域网
>2. 令牌总线  ，常用于总线型局域网
>3. 令牌环， 用于环形局域网，如令牌环网

- 局域网的分类

>1. 以太网
>2. 令牌环网
>3. FDDI网（光纤）
>4. ATM网
>5. 无线局域网

### 6.2 MAC子层和LLC子层

![image-20220428183506750](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220428183506750.png)



### 6.3 以太网

- 以太网是当今现有局域网采用的**最通用**的通信协议标准。以太网络使用**CSMA/CD**技术。
- 以太网提供无连接、不可靠的服务
- 以太网拓扑：逻辑上总线型，物理上星型。

</br>

#### 6.3.1 10BESE-T以太网

- 10BASE-T是传送基带信号的**双绞线以太网**，T表示采用双绞线，现10BASE-T 采用的是无屏蔽双绞线 （UTP），传输速率是**10Mb/s**。
- 物理上采用星型拓扑，逻辑上总线型，每段双绞线最长为100m。
- 采用曼彻斯特编码
- 采用CSMA/CD介质访问控制。

#### 6.3.2 以太网MAC帧

- 最常用的MAC帧是以太网**V2**的格式。

![image-20220428231940471](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220428231940471.png)

</br>

#### 6.3.3 高速以太网

- 速率**≥100Mb/s**的以太网称为高速以太网

>1. 100BASE-T以太网
>   - 在双绞线上传送**100Mb/s**基带信号的星型拓扑以太网，仍使用IEEE802.3的CSMA/CD协议。 支持**全双工**和**半双工**，可在全双工方式下工作而无冲突。
>2. 吉比特以太网
>   - 在光纤或双绞线上传送**1Gb/s**信号，支持**全双工**和**半双工**，可在全双工方式下工作而无冲突。
>3. 10吉比特
>   - 10吉比特以太网在光纤上传送**10Gb/s**信号，**只支持全双工**，无争用问题。

</br>

### 6.4 无线局域网

- **IEEE 802.11**是无线局域网通用的标准

#### 6.4.1 802.11的MAC帧头格式

![image-20220428232716204](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220428232716204.png)

![image-20220428232735496](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220428232735496.png)



- 无限局域网的分类

>1. 有固定基础设施无线局域网
>2. 无固定基础设施无线局域网的自组织网络

</br>

## 7. 广域网

- 广域网简称 **WAN**，主要使用**分组交换技术**。如因特网 （Internet）是世界范围内最大的广域网。

### 7.1 PPP协议

- 点对点协议PPP 是目前使用最广泛的**数据链路层协议**，用户使用**拨号电话接入因特网**时一般都使用 PPP协议。**只支持全双工**链路，**面向字节**

1. PPP协议应该满足的要求

![image-20220428233433809](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220428233433809.png)

2. PPP协议无需满足的要求

![image-20220428233524092](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220428233524092.png)

3. PPP协议的三个组成部分

>1. 一个将IP数据报封装到串行链路（同步串行/异步串行）的方法。
>2. 链路控制协议LCP：建立并维护数据链路连接。 **身份验证**
>3. 网络控制协议NCP：PPP可支持多种网络层协议，每个不同的网络层协议都要一个相应的NCP来配 置，为网络层协议建立和配置逻辑连接。

4. PPP协议帧格式

![image-20220428233721910](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220428233721910.png)

### 7.2 HDLC协议

- 高级数据链路控制（HDLC），是**面向比特**的数据链路层协议，数据报文可透明传输，用于实现透明传输的“0比特插入法”易于硬件实现，采用**全双工通信** ，所有帧采用CRC检验，对信息帧进行**顺序编号**，可防止漏收或重份，**传输可靠性高**。

1. HDLC的站

>1. **主站**的主要功能是**发送帧、接收响应帧**，并负责对整个链路的控制系统的初启、 流程的控制、差错检测或恢复等。 
>2. **从站**的主要功能是**接收**由主站发来的命令帧，**向主站发送响应帧**，并且配合主站参与差错恢复等链路控制。 
>3. **复合站**的主要功能是**既能发送，又能接收命令帧和响应帧**，并且负责整个链路的控制。

2. HDLC的帧格式

![image-20220428234318745](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220428234318745.png)

</br>

### 7.3 PPP协议＆HDLC协议

![image-20220428234434876](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220428234434876.png)

</br>

## 8. 数据链路层设备



### 8.1 网桥

- 网桥根据MAC帧的目的地址对帧进行转发和过滤。当网桥收到一个帧时，并不向所有接口转发此帧，而先检查此帧的目的MAC地址，然后再确定将该帧转发到哪一个接口，或者是把它丢弃（即过滤）。
- 网桥的优点：

>1. 过滤通信量，增大吞吐量。 
>2. 扩大了物理范围。 
>3. 提高了可靠性。 
>4. 可互连不同物理层、不同MAC子层和不同速率的以太网。

- 网段：一般指一个计算机网络中**使用同一物理层设备**（传输介质，中继器，集线器等）**能够直接通讯**的那一 部分

#### 1. 透明网桥

- “透明”指以太网上的站点并不知道所发送的帧将经过哪几个网桥，是一种即插即用设备—**自学习**

#### 2. 源路由网桥

- 在发送帧时，把详细的最佳路由信息（路由最少/时间最短）放在帧的首部中
- 方法：源站以**广播方式**向欲通信的目的站发送一个发现帧。

</br>

### 8.3 交换机

- **多接口网桥——以太网交换机**

#### 1. 直通式交换机

- 查完目的地址（6B）就立刻转发。  延迟小，可靠性低，无法支持具有不同速率的端口的交换

#### 2. 存储转发式交换机

- 将帧放入高速缓存，并检查否正确，正确则转发，错误则丢弃。

- 延迟大，可靠性高，可以支持具有不同速率的端口的交换。

</br>

### 8.3 广播域和冲突域

- 广播域：网络中能接收 任一设备发出的广播帧 的所有设备的集合。简 单的说如果站点发出一 个广播信号，所有能接 收收到这个信号的设备 范围称为一个广播域。

- 冲突域：在同一个冲突 域中的每一个节点都能 收到所有被发送的帧。 简单的说就是同一时间 内只能有一台设备发送 信息的范围。

  ![image-20220428235600576](https://herozql.oss-cn-beijing.aliyuncs.com/main/image-20220428235600576.png)
