---
title: 网络层
date: 2022/5/8
categories: 计算机网络
tags: [计算机网络]
top_img: https://herozql.oss-cn-beijing.aliyuncs.com/bg_pic/bing_59.jpg
cover: https://herozql.oss-cn-beijing.aliyuncs.com/bg_pic/bing_59.jpg
---

# 第四章 网络层

## 1. 网络层的功能

### 1.1 功能

- 主要任务是把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务。 网络层传输单位是数据报。

>- 功能一：路由选择与分组转发 
>- 功能二：异构网络互联 
>- 功能三：拥塞控制

### 1.2 IP数据报

![](https://herozql.oss-cn-beijing.aliyuncs.com/mainIMG_0114.HEIC.JPG)

>1. 版本：IPv4 / IPv6
>2. 首部长度：单位是4B，最小为5
>3. 区分服务：指示期望获得哪 种类型的服务
>4. 总长度：首部+数据，单位是1B
>5. 协议：数据部分的协议
>6. 首部校验和：首部校验只占分组的首部，而不校验数据部分
>7. 可选字段:0~40B ,用来支持排错、 测量以及安全等措施
>8. 填充:，全0，把首部补成4B的 整数倍
>9. 标识：同一数据报的分片使 用同一标识
>10. 标志：只有2位有意义 x _ _
>
>>中间位DF（Don’t Fragment）： DF=1，禁止分片 DF=0，允许分片
>>
>>最低位MF （More Fragment） ： MF=1，后面“还有分片” MF=0，代表最后一片/没分片
>
>11. 片偏移：指出较长分组分片后， 某片在原分组中的相对位置。 以8B为单位
>12. 除了最后一个分片，每个分片长度一定是**8B的整数倍**
>
>- **注意：总长度单位是1B，片偏移单位是8B，首部长度单位是4B**



## 2. IPV4

### 2.1 IPV4分组

![image-20220509175423052](https://herozql.oss-cn-beijing.aliyuncs.com/mainimage-20220509175423052.png)

![image-20220509175512124](https://herozql.oss-cn-beijing.aliyuncs.com/mainimage-20220509175512124.png)

- A类地址最大可用网络数是2的7次方-2，127回环不能用，全为零不能用



### 2.2 NAT、子网划分与子网掩码、CIDR

- NAT——安装在路由器上的，让局域网连接到广域网，分配给路由器全球唯一的IP
- 子网掩码：网络号全为1,主机号全为0
- 网络地址：子网掩码于IP地址按位与
- 按位与：1&1=1,其余为0
- 使用子网时的分组转发：

>路由表中：
>
>1. 目的网络地址
>2. 目的网络子网掩码
>3. 下一跳地址
>
>路由转发时的分组算法：
>
>1. 提取目的IP地址
>2. 是否直接交付
>3. 特定主机路由
>4. 检测路由表中有无路径
>5. 默认路由0.0.0.0
>6. 丢弃，报告，报告转发分组出错

#### CIDR

- CIDR（无分类编址）

>网络前缀/地址块
>
>e.g. 128.14.32.0/20

- 超网：许多子网聚合成的更大的子网

>方法：所有网络地址取交集

- 最长地址匹配：使用CIDR时，查找路由表可能得到几个匹配结果（跟网络掩码按位相与），应选择具有最长网络前缀的路由。 前缀越长，地址块越小，路由越具体。



### 2.3 ARP、DHCP与ICMP

#### 2.3.1 ARP

- 物理链路层传输帧必须使用MAC地址
- ARP：IP映射成MAC
- ARP协议4种典型情况：

>1. 主机A发给本网络上的主机B：用ARP找到主机B的硬件地址； 
>2. 主机A发给另一网络上的主机B：用ARP找到本网络上一个路由器的硬件地址
>3.  路由器发给本网络的主机A：用ARP找到主机A的硬件地址
>4. 路由器发给另一网络的主机B：用ARP找到本网络上的一个路由器的硬件地址

ARP过程：检查ARP高速缓存，若查不到，同一局域网中，广播ARP请求分组 ，单播ARP响应分组，写入缓存



#### 2.3.2 DHCP

- 应用层协议
- C/S 架构
- 全程通过广播进行交互
- 基于UDP
- DHCP提供**即插即用**联网的机制，主机可以从服务器动态获取IP地址、子网掩码、默认网关、DNS服务器名称与IP地址， 允许**地址重用**，支持**移动用户加入网络**，支持**在用地址续租**



#### 2.3.3 ICMP

- 目的：为了提高IP数据包交付成功的机会

- ICMP报文种类：ICMP差错报告报文（5种），ICMP询问报文（4种）

- 详见王道160

## 3. IPV6

### 3.1 IPV6 的格式

![image-20220509185438470](https://herozql.oss-cn-beijing.aliyuncs.com/mainimage-20220509185438470.png)

### 3.2 IPv6和IPv4

![image-20220509185924125](https://herozql.oss-cn-beijing.aliyuncs.com/mainimage-20220509185924125.png)

### 3.3 IPV6 表示形式

- 一般形式 冒号十六进制记法：4BF5:AA12:0216:FEBC:BA5F:039A:BE9A:2170
- 压缩形式

>1. 简化0：
>
>>简化前：4BF5:0000:0000:0000:BA5F:039A:000A:2176
>>
>>简化后：4BF5:0:0:0:BA5F:39A:A:2176
>
>2. 零压缩：一连串连续的0可以被一对冒号取代，双冒号表示法在**一个地址中仅可出现一次**。
>
>>FF05:0:0:0:0:0:0:B3  =>  FF05::B3

### 3.4 IPv6向IPv4过渡的策略

- 双栈协议：在一台设备上同时启用IPv4协议栈和IPv6协议栈
- 隧道技术：隧道协议将其它协议的数据帧或包重新封装然后通过隧道发送


## 4. 路由算法

### 4.1 静态路由与动态路由




### 4.2 距离-向量路由算法



### 4.3 链路状态路由算法



### 4.4 层次路由



## 5. 路由协议

### 5.1 自治系统



### 5.2 域内路由与域间路由



### 5.3 路由信息协议（RIP）



### 5.4 开放最短路径优先（OSPF）协议



### 5.5 边界网关协议（BGP）



## 6. IP组播

### 6.1 组播的概念



### 6.2 IP组播的地址



### 6.3 IGMP 与组播路由算法





## 7. 移动IP

### 7.1 移动IP的概念



### 7.2 移动IP通信过程



## 8. 网络层设备

### 8.1 冲突域和广播域



### 8.2 路由器的组成和功能



### 8.3 路由表与路由转发



## 9. 考点加强记忆
